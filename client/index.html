<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>LIGHT Messenger (Gaming)</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background-color: #202225; color: #dcddde; font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; }

    /* ì¢Œì¸¡ ì„œë²„ ì‚¬ì´ë“œë°” */
    #server-sidebar { width: 220px; background-color: #2f3136; border-right: 1px solid #202225; display: flex; flex-direction: column; }
    .sidebar-header { padding: 16px; font-weight: bold; color: #b9bbbe; border-bottom: 1px solid #202225; }
    .server-item { padding: 12px; cursor: pointer; color: #dcddde; }
    .server-item:hover { background-color: #36393f; }

    /* ë©”ì¸ ì±„íŒ… ì˜ì—­ */
    #main-content { flex: 1; display: flex; flex-direction: column; }
    #chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
    .message-item { background: #36393f; padding: 10px; border-radius: 8px; }
    .system-message { color: #b9bbbe; font-style: italic; }

    /* ì…ë ¥ ì˜ì—­ */
    #input-area { background: #2f3136; padding: 20px; border-top: 1px solid #202225; }
    .input-row { display: flex; gap: 10px; }
    input { flex: 1; background: #40444b; border: none; padding: 12px; color: white; border-radius: 5px; outline: none; }
    button { background: #5865f2; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }

    /* ìš°ì¸¡ ì˜¨ë¼ì¸ ìœ ì € ëª©ë¡ */
    #users-sidebar { width: 220px; background-color: #2f3136; border-left: 1px solid #202225; padding: 10px; }
    #users-sidebar h3 { color: #b9bbbe; margin-bottom: 10px; }
    #users-list { color: #dcddde; }
  </style>
</head>
<body>
  <!-- ì¢Œì¸¡ ì„œë²„ ëª©ë¡ -->
  <div id="server-sidebar">
    <div class="sidebar-header">ğŸ® SERVERS</div>
    <div class="server-item">MÃ¡y Chá»§ ChÃ­nh</div>
    <div class="server-item">Gamers VN</div>
    <div class="server-item">CSGO Team</div>
  </div>

  <!-- ë©”ì¸ ì±„íŒ… -->
  <div id="main-content">
    <div id="chat-container"></div>
    <div id="input-area">
      <div style="margin-bottom:10px;">
        <button id="google-login-btn">ğŸ” Google ë¡œê·¸ì¸</button>
        <span id="status">í˜„ì¬ ìƒíƒœ: ìµëª… ê²Œì´ë¨¸</span>
      </div>
      <div class="input-row">
        <input id="message" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
        <button onclick="send()">ì „ì†¡</button>
      </div>
    </div>
  </div>

  <!-- ìš°ì¸¡ ìœ ì € ëª©ë¡ -->
  <div id="users-sidebar">
    <h3>ğŸŸ¢ ONLINE (<span id="user-count">0</span>)</h3>
    <div id="users-list"></div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBA5UpytVU_dfQI4pMJ7A-pr4LN4jfU7lo",
      authDomain: "vn-gaming-messenger.firebaseapp.com",
      projectId: "vn-gaming-messenger"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const loginBtn = document.getElementById('google-login-btn');
    const statusSpan = document.getElementById('status');
    window.userName = "ìµëª… ê²Œì´ë¨¸";

    loginBtn.onclick = async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        window.userName = result.user.displayName;
        statusSpan.textContent = `${window.userName}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`;
        loginBtn.style.display = 'none';
      } catch (e) {
        alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + e.message);
      }
    };
  </script>

  <!-- Socket.io -->
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const chatContainer = document.getElementById('chat-container');
    const msgInput = document.getElementById('message');
    const usersList = document.getElementById('users-list');
    const userCount = document.getElementById('user-count');

    // ë©”ì‹œì§€ ìˆ˜ì‹ 
    socket.on('message', (data) => {
      const div = document.createElement('div');
      div.className = 'message-item';
      div.innerHTML = `<strong>${data.name}:</strong> ${data.msg} <span style="font-size:12px;color:#b9bbbe;">(${data.timestamp})</span>`;
      chatContainer.appendChild(div);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    });

    // ì‹œìŠ¤í…œ ë©”ì‹œì§€