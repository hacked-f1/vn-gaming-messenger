<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>LIGHT / VOID</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    body { display: flex; height: 100vh; font-family: 'Segoe UI', sans-serif; overflow: hidden; }

    /* VOID 모드 (기본) */
    body { background-color: #050505; color: #a020f0; }
    #server-sidebar { width: 220px; background-color: #000; border-right: 1px solid #a020f0; display: flex; flex-direction: column; }
    .sidebar-header { padding: 16px; font-weight: bold; text-shadow: 0 0 10px #a020f0; border-bottom: 1px solid #1a1a1a; }
    
    /* 서버 목록 스타일 */
    .server-list { flex: 1; overflow-y: auto; padding: 10px; }
    .server-btn { width: 100%; padding: 10px; margin-bottom: 5px; background: transparent; border: 1px border rgba(160, 32, 240, 0.3); color: #a020f0; text-align: left; cursor: pointer; font-size: 0.8em; }
    .server-btn:hover, .server-btn.active { background: rgba(160, 32, 240, 0.1); border-color: #a020f0; color: #fff; }
    .create-server-btn { padding: 10px; background: #1a1a1a; border: none; color: #444; cursor: pointer; font-size: 0.7em; }
    .create-server-btn:hover { color: #a020f0; }

    #main-content { flex: 1; display: flex; flex-direction: column; }
    #chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
    
    .message-item { background: rgba(160, 32, 240, 0.05); border: 1px solid #a020f0; padding: 10px; border-radius: 2px; }
    .msg-name { font-weight: bold; color: #fff; margin-right: 8px; text-shadow: 0 0 5px #a020f0; }
    .msg-time { font-size: 0.7em; color: #444; }

    #input-area { background: #000; padding: 20px; border-top: 1px solid #a020f0; }
    .input-row { display: flex; gap: 10px; }
    input#message { flex: 1; background: #0a0a0a; border: 1px solid #333; padding: 12px; color: #a020f0; outline: none; }
    
    button.action-btn { background: #a020f0; color: white; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; }
    button.action-btn:hover { box-shadow: 0 0 15px #a020f0; }

    /* LIGHT 모드 */
    body.light-theme { background-color: #ffffff; color: #2e2e2e; }
    body.light-theme #server-sidebar { background-color: #f2f3f5; border-right: 1px solid #ddd; }
    body.light-theme .server-btn { color: #555; border: 1px solid #ccc; }
    body.light-theme .server-btn.active { background: #00aff4; color: #fff; border-color: #00aff4; }
    body.light-theme .message-item { background: #f2f3f5; border: none; border-radius: 12px; color: #333; }
    body.light-theme .msg-name { color: #00aff4; text-shadow: none; }
    body.light-theme #input-area { background: #fff; border-top: 1px solid #eee; }
    body.light-theme input#message { background: #f9f9f9; color: #333; border: 1px solid #ddd; }
    body.light-theme button.action-btn { background: #00aff4; border-radius: 20px; }

    #users-sidebar { width: 180px; background-color: #000; border-left: 1px solid #a020f0; padding: 15px; }
    body.light-theme #users-sidebar { background-color: #f2f3f5; border-left: 1px solid #ddd; }
  </style>
</head>
<body class="void-theme">

  <div id="server-sidebar">
    <div class="sidebar-header" id="brand-name">VOID SYSTEM</div>
    <div class="server-list" id="server-list">
      <button class="server-btn active"># GLOBAL_LOBBY</button>
      </div>
    <button class="create-server-btn" onclick="createServer()">+ CREATE_NEW_NODE</button>
  </div>

  <div id="main-content">
    <div id="chat-container"></div>
    <div id="input-area">
      <div style="margin-bottom:10px; display: flex; align-items: center; gap: 10px;">
        <button id="login-btn" class="action-btn">ACCESS LOGIN</button>
        <span id="status" style="font-size: 0.8em; font-family: monospace;">STATUS: UNKNOWN_NODE</span>
        <button onclick="toggleTheme()" id="theme-toggle-btn" style="background:none; border:1px solid #444; color:#444; padding:5px 10px; cursor:pointer; font-size:0.7em;">ACTIVATE LIGHT</button>
      </div>
      <div class="input-row">
        <input id="message" placeholder="TYPE MESSAGE..." onkeypress="if(event.keyCode==13) send()">
        <button class="action-btn" onclick="send()">SEND</button>
      </div>
    </div>
  </div>

  <div id="users-sidebar">
    <h3 style="font-size: 0.7em; margin-bottom: 10px; color: #444;">ACTIVE_NODES</h3>
    <div id="users-list" style="font-size: 0.8em;"></div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBA5UpytVU_dfQI4pMJ7A-pr4LN4jfU7lo",
      authDomain: "vn-gaming-messenger.firebaseapp.com",
      projectId: "vn-gaming-messenger",
      storageBucket: "vn-gaming-messenger.firebasestorage.app",
      messagingSenderId: "561627453007",
      appId: "1:561627453007:web:71e824bc094a132ea97c3a"
    };
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const socket = io();
    window.userName = "UNKNOWN_GAMER";
    let currentServer = "GLOBAL_LOBBY";

    // 팝업 로그인으로 복구
    const loginBtn = document.getElementById('login-btn');
    loginBtn.addEventListener('click', async () => {
      try {
        await signInWithPopup(auth, provider);
      } catch (err) {
        console.error("Popup Error:", err);
        alert("팝업이 차단되었는지 확인해주세요!");
      }
    });

    onAuthStateChanged(auth, (user) => {
      if (user) {
        window.userName = user.displayName;
        document.getElementById('status').innerText = `STATUS: ${window.userName.toUpperCase()}`;
        loginBtn.style.display = 'none';
        socket.emit('join-server', { server: currentServer, name: window.userName });
      }
    });

    // 서버 창조 함수 (다음 단계 예고)
    window.createServer = function() {
      const serverName = prompt("생성할 노드(서버) 이름을 입력하세요:");
      if(serverName) {
        const btn = document.createElement('button');
        btn.className = 'server-btn';
        btn.innerText = `# ${serverName.toUpperCase()}`;
        document.getElementById('server-list').appendChild(btn);
        alert(`${serverName} 노드가 생성되었습니다. (서버 로직 연동 필요)`);
      }
    };

    window.send = function() {
      const msgInput = document.getElementById('message');
      if (msgInput.value.trim() !== "") {
        socket.emit('message', { 
          name: window.userName, 
          msg: msgInput.value,
          server: currentServer 
        });
        msgInput.value = "";
      }
    };

    socket.on('message', (data) => {
      const container = document.getElementById('chat-container');
      const div = document.createElement('div');
      div.className = 'message-item';
      div.innerHTML = `<span class="msg-name">${data.name}</span><br>${data.msg}`;
      container.appendChild(div);
      container.scrollTop = container.scrollHeight;
    });

    window.toggleTheme = function() {
      document.body.classList.toggle('light-theme');
      const isLight = document.body.classList.contains('light-theme');
      document.getElementById('theme-toggle-btn').innerText = isLight ? "ACTIVATE VOID" : "ACTIVATE LIGHT";
      document.getElementById('brand-name').innerText = isLight ? "LIGHT MESSENGER" : "VOID SYSTEM";
    };
  </script>
</body>
</html>