<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>LIGHT Messenger (Gaming)</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background-color: #202225; color: #dcddde; font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; transition: 0.3s; }
    body.light-theme { background-color: #f2f3f5; color: #2e2e2e; }

    /* ì¢Œì¸¡ ì„œë²„ ì‚¬ì´ë“œë°” */
    #server-sidebar { width: 220px; background-color: #2f3136; border-right: 1px solid #202225; display: flex; flex-direction: column; }
    body.light-theme #server-sidebar { background-color: #e3e5e8; border-right: 1px solid #ccc; }
    .sidebar-header { padding: 16px; font-weight: bold; color: #b9bbbe; border-bottom: 1px solid #202225; }
    body.light-theme .sidebar-header { color: #333; border-bottom: 1px solid #ccc; }
    .server-item { padding: 12px; cursor: pointer; color: #dcddde; }
    body.light-theme .server-item { color: #333; }
    .server-item:hover { background-color: #36393f; }
    body.light-theme .server-item:hover { background-color: #dcdcdc; }

    /* ë©”ì¸ ì±„íŒ… ì˜ì—­ */
    #main-content { flex: 1; display: flex; flex-direction: column; }
    #chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
    .message-item { background: #36393f; padding: 10px; border-radius: 8px; margin-bottom: 5px; line-height: 1.5; }
    body.light-theme .message-item { background: #fff; border: 1px solid #ddd; }
    .msg-name { font-weight: bold; color: #00aff4; margin-right: 8px; }
    .msg-time { font-size: 0.8em; color: #72767d; }

    /* ì…ë ¥ ì˜ì—­ */
    #input-area { background: #2f3136; padding: 20px; border-top: 1px solid #202225; }
    body.light-theme #input-area { background: #e3e5e8; border-top: 1px solid #ccc; }
    .input-row { display: flex; gap: 10px; }
    input#message { flex: 1; background: #40444b; border: none; padding: 12px; color: white; border-radius: 5px; outline: none; }
    body.light-theme input#message { background: #fff; color: #000; border: 1px solid #ccc; }
    button { background: #5865f2; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
    button:hover { background: #4752c4; }

    /* ìš°ì¸¡ ì˜¨ë¼ì¸ ìœ ì € ëª©ë¡ */
    #users-sidebar { width: 220px; background-color: #2f3136; border-left: 1px solid #202225; padding: 10px; }
    body.light-theme #users-sidebar { background-color: #e3e5e8; border-left: 1px solid #ccc; }
    #users-sidebar h3 { color: #b9bbbe; margin-bottom: 10px; font-size: 0.9em; }
    body.light-theme #users-sidebar h3 { color: #333; }
  </style>
</head>
<body>
  <div id="server-sidebar">
    <div class="sidebar-header">ğŸ® SERVERS</div>
    <div class="server-item">MÃ¡y Chá»§ ChÃ­nh</div>
    <div class="server-item">Gamers VN</div>
  </div>

  <div id="main-content">
    <div id="chat-container"></div>
    <div id="input-area">
      <div style="margin-bottom:10px; display: flex; align-items: center; gap: 10px;">
        <button id="login-btn">ğŸ” Google ë¡œê·¸ì¸</button>
        <span id="status">ìƒíƒœ: ìµëª… ê²Œì´ë¨¸</span>
        <button onclick="toggleTheme()">ğŸŒ— í…Œë§ˆ ì „í™˜</button>
      </div>
      <div class="input-row">
        <input id="message" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="if(event.keyCode==13) send()">
        <button onclick="send()">ì „ì†¡</button>
      </div>
    </div>
  </div>

  <div id="users-sidebar">
    <h3>ğŸŸ¢ ONLINE (<span id="user-count">0</span>)</h3>
    <div id="users-list"></div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

    // [ë¯¼ì„ë‹˜ í™•ì¸!] Firebase ì •ë³´ë¥¼ ë³¸ì¸ì˜ ì½˜ì†” ë‚´ìš©ìœ¼ë¡œ ì±„ì›Œì£¼ì„¸ìš”
    const firebaseConfig = {
      apiKey: "AIzaSy...", 
      authDomain: "vn-gaming-messenger.firebaseapp.com",
      projectId: "vn-gaming-messenger",
      appId: "1:..."
    };
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();
    provider.setCustomParameters({ prompt: 'select_account' });

    const socket = io();
    window.userName = "ìµëª… ê²Œì´ë¨¸";

    // ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­
    const loginBtn = document.getElementById('login-btn');
    loginBtn.addEventListener('click', async () => {
      try {
        await signInWithPopup(auth, provider);
      } catch (error) {
        console.error("ë¡œê·¸ì¸ ì—ëŸ¬:", error);
      }
    });

    // ì¸ì¦ ìƒíƒœ ê°ì‹œ (íŒì—… ë‹«íŒ í›„ ì²˜ë¦¬)
    onAuthStateChanged(auth, (user) => {
      if (user) {
        window.userName = user.displayName;
        document.getElementById('status').innerText = `ìƒíƒœ: ${window.userName}ë‹˜ ì ‘ì† ì¤‘`;
        loginBtn.style.display = 'none';
        socket.emit('message', { name: 'ì‹œìŠ¤í…œ', msg: `${window.userName}ë‹˜ì´ ì…ì¥í•˜ì…¨ìŠµë‹ˆë‹¤.` });
      }
    });

    // ë©”ì‹œì§€ ì „ì†¡
    window.send = function() {
      const msgInput = document.getElementById('message');
      const text = msgInput.value.trim();
      if (text !== "") {
        socket.emit('message', {
          name: window.userName,
          msg: text
        });
        msgInput.value = "";
      }
    };

    // ë©”ì‹œì§€ ìˆ˜ì‹ 
    socket.on('message', (data) => {
      const container = document.getElementById('chat-container');
      const div = document.createElement('div');
      div.className = 'message-item';
      if(data.name === 'ì‹œìŠ¤í…œ') div.style.color = '#72767d';
      
      div.innerHTML = `<span class="msg-name">${data.name}</span><span class="msg-time">${data.timestamp || ''}</span><br>${data.msg}`;
      container.appendChild(div);
      container.scrollTop = container.scrollHeight;
    });

    // ìœ ì € ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
    socket.on('users-list', (list) => {
      document.getElementById('user-count').innerText = list.length;
      document.getElementById('users-list').innerHTML = list.map(u => `<div>â€¢ ${u}</div>`).join('');
    });

    // í…Œë§ˆ ì „í™˜
    window.toggleTheme = function() {
      document.body.classList.toggle('light-theme');
    };
  </script>
</body>
</html>