<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Mini Discord - Tr√≤ chuy·ªán Th·ªùi gian Th·ª±c</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #313338; color: #dbdee1; font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; }
        #server-sidebar { width: 200px; background-color: #1e1f22; border-right: 1px solid #27272c; display: flex; flex-direction: column; }
        .sidebar-header { padding: 16px; font-weight: bold; color: #949ba4; border-bottom: 1px solid #27272c; }
        #main-content { flex: 1; display: flex; flex-direction: column; }
        #chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .message-item { background: #383a40; padding: 10px; border-radius: 8px; border-left: 4px solid #5865f2; }
        #input-area { background: #2b2d31; padding: 20px; border-top: 1px solid #27272c; }
        .input-row { display: flex; gap: 10px; margin-top: 10px; }
        input { flex: 1; background: #383a40; border: none; padding: 12px; color: white; border-radius: 5px; outline: none; }
        button { background: #5865f2; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #google-login-btn { background: #ffffff; color: #000; margin-bottom: 10px; width: 100%; }
        #users-sidebar { width: 200px; background-color: #1e1f22; border-left: 1px solid #27272c; padding: 10px; }
    </style>
</head>
<body>
    <div id="server-sidebar">
        <div class="sidebar-header">üéÆ SERVERS</div>
    </div>

    <div id="main-content">
        <div id="chat-container"></div>
        
        <div id="input-area">
            <div id="login-section">
                <button id="google-login-btn">üîê ƒêƒÉng nh·∫≠p b·∫±ng Google (Î°úÍ∑∏Ïù∏)</button>
            </div>

            <div id="user-info" style="margin-bottom: 10px; font-weight: bold; color: #5865f2;">
                ÏÉÅÌÉú: <span id="status">Î°úÍ∑∏Ïù∏ ÎåÄÍ∏∞ Ï§ë...</span>
            </div>

            <div class="input-row">
                <input id="message" placeholder="Nh·∫≠p tin nh·∫Øn... (Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî)">
                <button onclick="send()">G·ª≠i</button>
            </div>
        </div>
    </div>

    <div id="users-sidebar">
        <div style="font-weight: bold; margin-bottom: 10px;">üü¢ ONLINE</div>
        <div id="users-list"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBA5UpytVU_dfQI4pMJ7A-pr4LN4jfU7lo",
            authDomain: "vn-gaming-messenger.firebaseapp.com",
            projectId: "vn-gaming-messenger",
            storageBucket: "vn-gaming-messenger.firebasestorage.app",
            messagingSenderId: "561627453007",
            appId: "1:561627453007:web:71e824bc094a132ea97c3a"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        window.auth = auth;
        window.provider = provider;
        window.signInWithPopup = signInWithPopup;
    </script>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const msgInput = document.getElementById('message');
        const chatContainer = document.getElementById('chat-container');
        const statusSpan = document.getElementById('status');
        const loginBtn = document.getElementById('google-login-btn');

        let userName = "ÏùµÎ™Ö Í≤åÏù¥Î®∏";

        loginBtn.onclick = async () => {
            try {
                const result = await window.signInWithPopup(window.auth, window.provider);
                userName = result.user.displayName;
                statusSpan.textContent = userName + "Îãò ÌôòÏòÅÌï©ÎãàÎã§!";
                loginBtn.style.display = 'none';
            } catch (e) {
                alert("Î°úÍ∑∏Ïù∏ Ïã§Ìå®: " + e.message);
            }
        };

        socket.on('message', (data) => {
            const div = document.createElement('div');
            div.className = 'message-item';
            div.innerHTML = `<strong>${data.name}:</strong> ${data.msg}`;
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        });

        function send() {
            const msg = msgInput.value.trim();
            if (msg) {
                socket.emit('message', { name: userName, msg: msg });
                msgInput.value = '';
            }
        }

        msgInput.onkeypress = (e) => { if (e.key === 'Enter') send(); };
    </script>
</body>
</html>